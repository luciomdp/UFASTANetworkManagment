# SSH Key-based Authentication Setup Script

This script automates the process of setting up SSH key-based authentication for a remote server. The goal is to generate an SSH key pair (public and private keys), configure the server to allow passwordless login using the public key, and verify that the SSH key-based authentication works properly.

## Purpose

The primary objective of this script is to simplify the setup of passwordless SSH login by generating an SSH key pair and securely copying the public key to the remote server. This is particularly useful for automating access to servers without the need to manually input passwords each time a connection is made.

## Precondition

Before running the script, make sure to create a `.env` file inside this folder with the following format:

```plaintext
SERVER_DOMAIN=your-server-domain.com
SSH_PORT=your-ssh-port
USER=your-ssh-username
```

## Script Breakdown

### 1. **Generate SSH Key Pair**

The script first checks if an SSH key pair already exists. If not, it generates a new key pair using the `ssh-keygen` command.

**Command used:**

```bash
ssh-keygen -t rsa -b 4096 -f "$PRIVATE_KEY" -N ""
```

- ssh-keygen: The command used to generate a new SSH key pair.

- -t rsa: Specifies the type of key to generate. rsa is one of the most commonly used and secure algorithms for SSH keys.

- -b 4096: Specifies the size of the key in bits. 4096 bits is considered a strong level of encryption and is widely recommended.

- -f "$PRIVATE_KEY": Defines the file name and path where the private key will be saved. In this case, the private key will be stored in ~/.ssh/id_rsa.

- -N "": Sets the passphrase for the private key. An empty string ("") means no passphrase is set, allowing for passwordless authentication.

### 2. Copy Public Key to Remote Server
Once the key pair is generated, the script proceeds to copy the public key (id_rsa.pub) to the remote serverâ€™s ~/.ssh/authorized_keys file using the ssh-copy-id tool.

Command used:
```bash
ssh-copy-id -i "$PUBLIC_KEY" -p $SSH_PORT $USER@$SERVER_DOMAIN
```
- ssh-copy-id: The command used to copy the public key to the remote server.

- -i "$PUBLIC_KEY": Specifies the public key file to copy. In this case, it's the default id_rsa.pub generated by ssh-keygen.

- -p $SSH_PORT: Specifies the port number for the SSH connection. The default SSH port is 22.

- $USER@$SERVER_DOMAIN: Defines the user and the server domain where the public key will be copied. 

SSH_PORT, USER and SERVER_DOMAIN are all variables stored in .env file for security purposes.

### 3. Test SSH Key Authentication
After the public key is copied to the remote server, the script tests whether the SSH key-based authentication is working by attempting to log into the server using SSH.

Command used:
```bash
ssh -p $SSH_PORT $USER@$SERVER_DOMAIN "echo 'SSH key-based authentication successful!'"
```

After attempting the SSH login, the script checks the exit status ($?) to determine whether the connection was successful. If the login was successful, a success message is displayed; otherwise, an error message is shown.